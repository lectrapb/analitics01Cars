---
title: "ANALISIS EXPLORATORIO 1 CONCESIONARIO DE AUTOS"
author: Alejandra Cifuentes / Giovanny Porras 
output: 
  pdf_document:
     latex_engine: pdflatex
     toc: true
     keep_tex: true
header-includes:
  - \renewcommand{\contentsname}{Índice}
date: "2025-05-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r instalacion librerias, eval=FALSE, include=FALSE}
# Instala paquetes necesarios para el reporte
#install.packages("ggplot2")
#install.packages("readxl")
#install.packages("tidyr")
#install.packages("dplyr")
#install.packages("knitr")
install.packages("kableExtra")
#install.packages("tinytex")
#tinytex::install_tinytex()

```


```{r importaciones, include=FALSE}
library(ggplot2)
library(readxl)
library(tidyr)
library(dplyr)
library(knitr)
library(DT)
library(kableExtra)
library(forcats)
```

## 2 Exploracion de datos 

a. Descargar el archivo TABLA_TALLER.xlsx
b. Cargar el archivo de datos en RStudio 

**Rta:** Carga de datos inicial 
```{r carga de datos inicial, include=TRUE}
#datos_base <- read_excel("D:/MaestriaAnalitica/BasesAnalitica/gitRepository/Proyecto-02-Autos/BASE/t1fe-tabla_taller.xlsx")
datos_base <- read_excel("C:/Users/PC/Documents/ANALITICA/analitics01Cars/BASE/t1fe-tabla_taller.xlsx")
kable(head(datos_base, 10,  caption = "Datos iniciales"), format = "latex", booktabs = TRUE) %>% 
  kable_styling(latex_options = c("scale_down", "hold_position"))
```
 
```{r impresion_datos_base, include=FALSE}
# imprimir datos base 
Sys.setlocale("LC_ALL", "Spanish_Colombia.UTF-8")
print(datos_base)
```

c. Describir brevemente la estructura del conjunto de datos: ¿Cuantos clientes estan registrados y que variables incluyen?

```{r calcular-conteo, include=TRUE}
no_datos_persona <- datos_base %>%
  filter(grepl("PERSONA", PERSONA)) %>%
  count()

cabeceras_datos <- names(datos_base)
```

**Rta:** El conjunto de datos tiene `r no_datos_persona ` clientes registrados e incluyen las varibles `r cabeceras_datos ` .

d. Realizar una exploracion rapida utilizando funciones como head(), tail(), str(), summary(), 
**Rta:** Los ultimos valores son (tail)
```{r tail, include=TRUE}
ultimos_datos <- tail(datos_base)
kable(head(ultimos_datos, 10, caption = "Datos ultima posicion"), format = "latex", booktabs = TRUE) %>%kable_styling(latex_options = c("scale_down", "hold_position"))
```
**Funciones adicionales:**
```{r}
#print(str(datos_base))
#print(dim(datos_base))
#print(colnames(datos_base))
print(summary(datos_base))
```
e. Identificar si hay datos faltantes y cuantificar cuantos son en total y por variable 

```{r}
#is.na(datos_base)
total_na = datos_base %>% is.na %>% sum()  
#Contar NA por columna(variable) 
na_por_columna <- colSums(is.na(datos_base))
tabla_na <- data.frame(
   Variable = names(na_por_columna), 
   total_na = as.vector(na_por_columna) 
)

#Contar NA total 
#rowSums(is.na(datos_base))

#Impresion de tabla 
#kable(tabla_na, caption = "Variables faltantes por cuantificar")  %>%
#  kable_styling(full_width = FALSE, position = "left")

```
**Rta**: 
- El numero de total de datos faltantes es  **`r total_na`** y por variable son los siguientes:
```{r tabla_variables_na, echo=FALSE, results='asis'}
kable(tabla_na, caption = "Variables faltantes por cuantificar")  %>%
  kable_styling(full_width = FALSE, position = "left")
```
- Analisis: Hay problemas de datos en todas las variables sera importante discriminar cada caso 

f. Comentar sobre los posibles problemas en los datos: 

  **Filas vacías al inicio del archivo:** 
  - Las dos primeras filas están vacías o no contienen datos válidos.

  **Inconsistencias categóricas:**
  
   - Variabilidad en la codificación de la variable SEXO, con valores como f, mujer, hombre, nan o minúsculas inconsistentes.
   - Formatos no estandarizados en NIVEL ESCOLAR, como el uso de PhD en lugar de DOCTORADO.
   - Uso de minúsculas en valores de MARCA DE AUTO, como renault.

  **Valores faltantes:** 
  
  - Algunas filas tienen múltiples variables vacías, como en el caso de la PERSONA 24.

  **Valores extremos o anómalos (outliers):**
  
  - PERSONA 31: valor de ESTATURA = 3.45 m, fuera del rango fisiológico normal.
  - PERSONA 33: valor de NUMERO DE HIJOS = 54, ampliamente fuera del promedio observado (3.03).
  
```{r observaciones, include=FALSE}
## Observaciones

#1. Las dos primeras filas se pueden eliminar ya que no cuentan con datos.
#2. La PERSONA 15 tiene en la variable **SEXO** el valor de **MUJER**, que es inconsistente.
#3. La PERSONA 31 tiene en la variable **SEXO** el valor de **nan**, que es inconsistente.
#4. La PERSONA 32 tiene en la variable **SEXO** el valor de **HOMBRE**, que es inconsistente.
#5. La PERSONA 36 tiene en la variable **SEXO** el valor de **m**, que es inconsistente.
#6. La PERSONA 37 tiene en la variable **SEXO** el valor de **m**, que es inconsistente.
#7. La PERSONA 38 tiene en la variable **SEXO** el valor de **mujer**, que es inconsistente.
#8. La PERSONA 39 tiene en la variable **SEXO** el valor de **m**, que es inconsistente.
#9. La PERSONA 40 tiene en la variable **SEXO** el valor de **hombre**, que es inconsistente.
#10. La PERSONA 51 tiene en la variable **SEXO** el valor de **MUJER**, que es inconsistente.
#11. La PERSONA 18 tiene en la variable **NIVEL ESCOLAR** el valor **PHD** en vez de **DOCTORADO**.
#12. La PERSONA 33 tiene en la variable **NIVEL ESCOLAR** el valor **PHD** en vez de **DOCTORADO**.
#13. La PERSONA 40 tiene en la variable **NIVEL ESCOLAR** el valor **PHD** en vez de **DOCTORADO**.
#14. La PERSONA 54 tiene en la variable **NIVEL ESCOLAR** el valor **PHD** en vez de **DOCTORADO**.
#15. La PERSONA 24 tiene varios datos faltantes en las variables de **EDAD, NIVEL ESCOLAR, NUMERO DE HIJOS**.
#16. La PERSONA 33 tiene en la variable **NUMERO DE HIJOS** un valor de **54**, que es anormalmente alto respecto a la media (3.03).
#17. La PERSONA 31 tiene en la variable **ESTATURA** un valor de **3.45**, que es anormal respecto a la media (1.69).
#18. La PERSONA 4 tiene en la variable **SEXO** el valor **f**, que no sigue el formato en mayúsculas usado en los demás registros.
#19. La PERSONA 18 tiene en la variable **SEXO** el valor **f**, que no sigue el formato en mayúsculas usado en los demás registros.
#20. La PERSONA 36 tiene en la variable **SEXO** el valor **m**, que no sigue el formato en mayúsculas usado en los demás registros.
#21. La PERSONA 37 tiene en la variable **SEXO** el valor **m**, que no sigue el formato en mayúsculas usado en los demás registros.
#22. La PERSONA 38 tiene en la variable **SEXO** el valor **mujer**, que no sigue el formato en mayúsculas usado en los demás registros.
#23. La PERSONA 39 tiene en la variable **SEXO** el valor **m**, que no sigue el formato en mayúsculas usado en los demás registros.
#24. La PERSONA 40 tiene en la variable **SEXO** el valor **hombre**, que no sigue el formato en mayúsculas usado en los demás registros.
#25. La PERSONA 54 tiene en la variable **SEXO** el valor **f**, que no sigue el formato en mayúsculas usado en los demás registros.
#26. La PERSONA 58 tiene en la variable **SEXO** el valor **f**, que no sigue el formato en mayúsculas usado en los demás registros.
#27. La PERSONA 18 tiene en la variable **NIVEL ESCOLAR** el valor **PhD**, que no sigue el formato en mayúsculas usado en los demás registros.
#28. La PERSONA 33 tiene en la variable **NIVEL ESCOLAR** el valor **PhD**, que no sigue el formato en mayúsculas usado en los demás registros.
#29. La PERSONA 40 tiene en la variable **NIVEL ESCOLAR** el valor **PhD**, que no sigue el formato en mayúsculas usado en los demás registros.
#30. La PERSONA 54 tiene en la variable **NIVEL ESCOLAR** el valor **PhD**, que no sigue el formato en mayúsculas usado en los demás registros.
#31. La PERSONA 36 tiene en la variable **MARCA DE AUTO** el valor **renault**, que no sigue el formato en mayúsculas usado en los demás registros.

```
  

\newpage

## 3 Análisis de la variable Marca "Marca de auto".  

a. Evaluar la variable **"MARCA DE AUTO"** y determinar si hay faltantes. 

```{r}
 #datos_base$`MARCA DE AUTO`(is.na)
 #(is.na(datos_base$`MARCA DE AUTO`))
 data_na_marca_autos <- sum(is.na(datos_base$`MARCA DE AUTO`))
```
**Rta:** 
Se tratan datos faltantes y se encuentran un total de   **`r data_na_marca_autos`**;  se realiza tratamiento de datos remplazando los "na"/"NA" a "NO_MANEJA", se convierte todo mayúsculas.
```{r}
 Sys.setlocale("LC_ALL", "Spanish_Colombia.UTF-8")
 #Eliminar columna 1, 2 
 datos_base <- datos_base[-c(1,2), ]
 #Datos Eliminados
 #print(datos_base)
 na_marca_autos <- sum(is.na(datos_base$`MARCA DE AUTO`)) 
 # PERSONA 13, 32, 49, NA y datos vacios 
 datos_base$`MARCA DE AUTO`[is.na(datos_base$`MARCA DE AUTO`) | datos_base$`MARCA DE AUTO` == "NA"] <- "SIN_CONFIRMAR"
 # PERSONA 39 cambia FOR A FORD 
 datos_base$`MARCA DE AUTO`[ datos_base$`MARCA DE AUTO` == "FOR"] <- "FORD"
 # PERSONA 40 cambia BWM A BMW 
 datos_base$`MARCA DE AUTO`[ datos_base$`MARCA DE AUTO` == "BWM"] <- "BMW"
 
 #print(datos_base)
 # PERSONA 36 cambio a mayuscula marca 
 datos_base$`MARCA DE AUTO` <- toupper(datos_base$`MARCA DE AUTO`)
 print(datos_base)
```

b. Crear un tabla de frecuencias para entender la popularidad de las diferentes marcas entre los cliente. 
**Rta:** En la tabla de frecuencias se observa que las marcas más populares son AUDI, CHEVROLET, RENAULT y BMW. Los tres usuarios que no tienen la categoría ""SIN_CONFIRMAR"" se identificaron como personas a partir de 50 años       
```{r}
tabla_frecuencias_autos <- as.data.frame(table(datos_base$`MARCA DE AUTO`))
names(tabla_frecuencias_autos) <- c("MARCA DE AUTO", "Frecuencia")
#Organizar Mayor a menor
tabla_frecuencias_autos <- tabla_frecuencias_autos %>% arrange(desc(Frecuencia))
print(tabla_frecuencias_autos)
```

c. Generar graficos de barras y de tortas para visualizar la distribucion de las marcas de autos y proporcionar una interpretacion. 
**Rta: **
Se identifica que las marcas de vehiculos preferidas por los clientes del concesionario son **AUDi** 
y **RENAULT**; se observa una segmentacion igual por pares entre las entre AUDI/RENAULT y CHEVROLET/BMW

```{r grafico_barras_marcas, echo=FALSE, results='asis' }

#Diagrama de barras MARCA AUTO

ggplot(tabla_frecuencias_autos, aes(x = fct_reorder(`MARCA DE AUTO`, Frecuencia, .desc = TRUE), 
                                    y = Frecuencia, fill = `MARCA DE AUTO`)) +
  geom_bar(stat = "identity",  fill = "steelblue") +
  geom_text(aes(label = Frecuencia), vjust = -0.5, size = 3.5) +
  labs(title = "Distribución de marcas de autos",
       x = "Marca de Auto",
       y = "Frecuencia") +
  #scale_fill_brewer(palette = "Set3") +  # Usando paleta predefinida para categorias
  theme_minimal() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 45, hjust = 1))  # Texto en Ãngulo para mejor lectura

```
**Rta: **
La preferencia de vehículos esta distribuida entre 4 marcas que suman 83% de la muestra, estas cuatro marcas a su vez representan dos segmentos que se reparten en el mismo porcentaje 21%/21% y 20%/20%.  
```{r}

```

d. Concluir cuál es la marca de auto más popular entre los clientes. 
**Rta:**
Se concluyen que AUDI y RENAULT son las marcas lideres con una distribución uniforme en el los clientes del concesionario en un porcentaje del 21.7 entre ambas ocupan el 42.4%.  
```{r}

tabla_frecuencias_autos$Porcentaje <- round(tabla_frecuencias_autos$Frecuencia/sum(tabla_frecuencias_autos$Frecuencia)*100, 1)
print(tabla_frecuencias_autos)
tabla_frecuencias_autos$`MARCA DE AUTO` <- factor(
  tabla_frecuencias_autos$`MARCA DE AUTO`,
  levels = tabla_frecuencias_autos$`MARCA DE AUTO`[order(-tabla_frecuencias_autos$Frecuencia)]
)
# Crear el grafico circular de MARCAS AUTOS 
ggplot(tabla_frecuencias_autos, aes(x = "", y = Frecuencia, fill = `MARCA DE AUTO`)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(Porcentaje, "%")),
            position = position_stack(vjust = 0.5),
            size = 4,
            color = "black",
            fontface = "bold") +
  labs(title = "Distribucion Marcas de Autos",
       fill = "MARCA DE AUTO") +
  scale_fill_brewer(palette = "Paired") +  # Usando paleta predefinida
  theme_void() +
  theme(legend.position = "right",
        plot.title = element_text(hjust = 0.5, face = "bold"))
```
\newpage

## 5 Análisis de la variable "Estatura".

a. Revisar la variable "ESTATURA" para asegurar que este correctamente importada y limpia.
**Rta:**
Se puede observar que la variable ESTATURA se encuentra con 60 registros de tipo numeric, sin registros de na y con valores ajustados dentro de las estaturas promedio, ya que se homologo un valor que se encontraba por fuera del valor posible en la edad de una persona. 
```{r}
#Se convierte a numerico el dato caracter
datos_base$ESTATURA <- as.numeric(datos_base$ESTATURA)
#Se reemplaza el valor especifico de la columna ESTATURA en el registro 31
datos_base$ESTATURA[datos_base$ESTATURA == 3.450] <- 1.685
#confirmación del tipo de dato
class(datos_base$ESTATURA)
#Se confirma que no tiene na
sum(is.na(datos_base$ESTATURA))
#Se confirma estructura y media de la variable
summary(datos_base$ESTATURA)
```

b. Identificar los datos faltantes o valores inconsistentes. Eliminar esos registros.
**Rta:**
En el anterior respuesta se evidencia que se identifico el registro de un dato  atipico con valor de 3.450 en estatura, y se homologo por el valor de la media de los registros 1,685

c. Generar un poligono de frecuencia y una ojiva para analizar la distribución de la estatura de los clientes y extraer conclusiones.
**Rta:**
```{r}
print(datos_base$ESTATURA)

#Polígono de frencuencias (sencillo)

# Polígono de frecuencias con intervalos automáticos
ggplot(datos_base, aes(x = ESTATURA)) +
  geom_freqpoly(binwidth = 5, color = "steelblue", size = 1) +
  labs(title = "Polígono de Frecuencias - Estatura",
       x = "Estatura (metros)",
       y = "Frecuencia") +
  theme_minimal()

summary(datos_base$EDAD)
datos_base$EDAD <- as.numeric(datos_base$EDAD)
is.na(datos_base$EDAD)


# Polígono de frecuencias con intervalos automáticos
ggplot(datos_base, aes(x = EDAD)) +
  geom_freqpoly(binwidth = 5, color = "steelblue", size = 1) +
  labs(title = "Polígono de Frecuencias - Estatura",
       x = "Estatura (metros)",
       y = "Frecuencia") +
  theme_minimal()
```


```{r}
#Polígono de frecuencias detallado por intervalos 

# Crear intervalos para Estatura
intervalos_estatura <- seq(from = floor(min(datos_base$ESTATURA, na.rm = TRUE)/5)*5,
                       to = ceiling(max(datos_base$ESTATURA, na.rm = TRUE)/5)*5,
                       by = 5)```{r}
                       print(intervalos_estatura)

# Crear tabla de frecuencias con intervalos
tabla_freq_estatura <- datos_base %>%
  mutate(Grupo_Estatura = cut(Estatura, 
                          breaks = intervalos_estatura, 
                          include.lowest = TRUE, 
                          right = FALSE)) %>%
  group_by(Grupo_Estatura) %>%
  summarise(Frecuencia = n()) %>%
  arrange(Grupo_Estatura)

# Extraer los valores medios de cada intervalo para el eje X
tabla_freq_edad$Valor_Medio <- as.numeric(sapply(tabla_freq_edad$Grupo_Edad, function(x) {
  rango <- as.character(x)
  limites <- as.numeric(unlist(strsplit(gsub("\\[|\\)|\\[|\\]", "", rango), ",")))
  return(mean(limites))
}))

# Crear polígono de frecuencias
ggplot(tabla_freq_edad, aes(x = Valor_Medio, y = Frecuencia, group = 1)) +
  geom_point(size = 3, color = "steelblue") +
  geom_line(color = "steelblue", size = 1) +
  geom_text(aes(label = Frecuencia), vjust = -0.8, size = 3.5) +
  labs(title = "Polígono de Frecuencias - Edad por Grupos",
       x = "Edad (años)",
       y = "Frecuencia") +
  scale_x_continuous(breaks = tabla_freq_edad$Valor_Medio,
                     labels = as.character(tabla_freq_edad$Grupo_Edad)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
  OJIVA 
#Ojiva de frencuencias acumuladas

# Crear intervalos y calcular frecuencias acumuladas en un solo paso
histData <- hist(datos_base$ESTATURA, breaks = seq(min(datos_base$ESTATURA, na.rm = TRUE), 
                                         max(datos_base$ESTATURA, na.rm = TRUE) + 5, 
                                         by = 5), 
                plot = FALSE)

# Crear dataframe para la ojiva
ojiva_data <- data.frame(
  x = histData$breaks,
  y = c(0, cumsum(histData$counts))
)

# Graficar ojiva
ggplot(ojiva_data, aes(x = x, y = y)) +
  geom_line(color = "darkred", size = 1) +
  geom_point(color = "darkred", size = 3) +
  labs(title = "Ojiva - Frecuencias Acumuladas de Estatura",
       x = "Estatura (metros)",
       y = "Frecuencia Acumulada") +
  theme_minimal()

```
                       



\newpage

## 6 Análisis de la variable "Numero de hijos".

a. Cambiar el nombre de la varaible a "n.hijos" para facilitar su manejo.
**Rta:**
Se realiza consulta de lal data frame original, posteriormente se le aplica el tratamiento solicitado guardando el resultado en un nuevo dataframe y por ultimo se consulta el dataframe creado para evidenciar el resultado.
```{r}
print(datos_base)
nueva_datos_base <-
  rename(datos_base,N_HIJOS="NUMERO DE HIJOS")
print(nueva_datos_base)
```


b. Identificar problemas con los datos y eliminar valores inconsistentes.
**Rta:**

```{r}
head(nueva_datos_base)
sum(is.na(nueva_datos_base$N_HIJOS))
is.na(nueva_datos_base$N_HIJOS)
summary(nueva_datos_base$N_HIJOS)
print(nueva_datos_base)
# Se identifica que la persona 24 tiene NA en la variable hijos, por lo que le aplica el tratamiento y se iguala a 0
nueva_datos_base$N_HIJOS[nueva_datos_base$N_HIJOS == "NA"] <- 0
```

c. Generar una grafica de barras con colores y analizar que se puede concluir sobre el numero de hijos de los clientes.
**Rta:**
```{r}

```

\newpage

## 7 Análisis de la variable "Sexo".

a. Revisar la consistencia de los datos de la varaible "SEXO" y realizar correcciones en caso de encontrar valores inusuales o inconsistentes.
**Rta:**
```{r}
is.na(datos_base$SEXO)
print(nueva_datos_base)
```


b. Crea una tabla de frecuencias y extraer conclusiones sobre la proporcion de hombres y mujeres en el conjunto de clientes.
**Rta:**

\newpage

## 8 Preguntas de investigación".
c. ¿Cuantos clientes con doctorado ganan mas de 2 millones de pesos?
**Rta:**
```{r}

print(datos_base)
datos_clientes_doctorado<- sum(data_base$NIVEL_ESCOLAR="DOCTORA") %>% filter(datos_base$SALARIO>2000000)
print(datos_clientes_doctirado)
```


d. ¿Cual es el promedio de salario por cada categoria de variable "MARCA DE AUTO"?
**Rta:**
```{r}
group_by(
  
) summary
datos_base %>% group_by(`MARCA DE AUTO`) %>% 
  summarise(mi
  summarise(median(datos_base$`SALARIO`)
```


